<!-- sgp-budget.component.html -->
<div class="sgp-container">
  <!-- TÃ­tulo principal solo si es necesario -->
  <!-- <h2 class="sgp-title">Sistema General de Participaciones</h2> -->

  <!-- TreeTable de PrimeNG -->
  <p-treetable [value]="budgetData"
               [columns]="cols"
               [paginator]="true"
               [rows]="20"
               [scrollable]="true"
               scrollHeight="450px"
               selectionMode="single"
               [(selection)]="selectedNode"
               styleClass="sgp-treetable"
               [resizableColumns]="true"
               columnResizeMode="expand">

    <ng-template pTemplate="caption">
      <div class="sgp-table-header">
        <h3>Detalle Presupuestal SGP</h3>
        <button pButton type="button"
                icon="pi pi-download"
                label="Exportar"
                class="p-button-primary"
                (click)="exportData()">
        </button>
      </div>
    </ng-template>

    <ng-template pTemplate="header" let-columns>
      <tr>
        <th *ngFor="let col of columns"
            [style.width]="col.field === 'category' ? '40%' : '20%'"
            tResizableColumn>
          {{col.header}}
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
      <tr [ttRow]="rowNode" [ttSelectableRow]="rowNode">
        <td>
          <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
          <span [ngClass]="{'font-bold': !rowNode.parent || (rowNode.parent && !rowNode.parent.parent) || (rowNode.parent?.parent && !rowNode.parent.parent.parent)}">
            {{rowData.category}}
          </span>
        </td>
        <td class="text-right">{{rowData.presupuesto}}</td>
        <td class="text-right">{{rowData.iac}}</td>
        <td class="text-right">
          <span class="avance-badge" [ngClass]="getAvanceClass(rowData.avance)">
            {{rowData.avance}}
          </span>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td [attr.colspan]="4">No se encontraron registros.</td>
      </tr>
    </ng-template>
  </p-treetable>
</div>