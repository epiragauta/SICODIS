<div class="png-inversion-container">

    <!-- Banner -->
  <div class="gradient-banner">    
    <div class="gradient-overlay"></div>
    <div class="banner-content">
      <h1>Inversión por programa, proyecto, fuente</h1>
      <p>Este módulo presenta el reporte de inversión por programa, proyecto y fuente</p>
    </div>
  </div>

  <!-- Panel superior con filtros -->
  <div class="filters-panel">
    <div class="filters-row">
      <div class="p-field vigencia-select">
        <p-floatlabel class="w-full md:w-56" variant="on">
          <p-select 
            id="vigencia" 
            [options]="vigencias" 
            inputId="vigenciaSelect" 
            [(ngModel)]="selectedVigencia"
            (onChange)="onVigenciaChange($event)"
            optionLabel="vigencia" 
            optionValue="id_vigencia"
            placeholder="Vigencia">
          </p-select>
          <label for="vigenciaSelect">Vigencia</label>
        </p-floatlabel>
      </div>

      <div class="p-field periodo-select">
        <p-floatlabel class="w-full md:w-56" variant="on">
          <p-select 
            id="periodo" 
            [options]="periodos" 
            inputId="periodoSelect" 
            [(ngModel)]="selectedPeriodo"
            (onChange)="onPeriodoChange($event)"
            optionLabel="label" 
            placeholder="Periodo">
          </p-select>
          <label for="periodoSelect">Periodo</label>
        </p-floatlabel>
      </div>

      <div class="p-field departamento-select">
        <p-floatlabel class="w-full md:w-56" variant="on">
          <p-select 
            id="departamento" 
            [options]="departamentosData" 
            inputId="departamentoSelect"
            [(ngModel)]="selectedDepartamento" 
            (onChange)="onDepartamentoChange($event)"
            optionLabel="departamento" 
            placeholder="Departamento">
          </p-select>
          <label for="departamentoSelect">Departamento</label>
        </p-floatlabel>
      </div>

      <div class="p-field fuente-select">
        <p-floatlabel class="w-full md:w-56" variant="on">
          <p-select 
            id="fuente" 
            [options]="fuentes" 
            inputId="fuenteSelect"
            [(ngModel)]="selectedFuente" 
            (onChange)="onFuenteChange($event)"
            optionLabel="label" 
            placeholder="Fuente">
          </p-select>
          <label for="fuenteSelect">Fuente</label>
        </p-floatlabel>
      </div>

      <div class="p-field action-buttons">
        <button pButton type="button" icon="pi pi-refresh" label="Actualizar" 
          class="p-button-primary" (click)="onActualizar()" [disabled]="isLoading">
        </button>
        <button pButton type="button" icon="pi pi-eraser" label="Limpiar filtros" 
          class="p-button-secondary" (click)="clearFilters()">
        </button>
      </div>
    </div>
  </div>

  <!-- Content area -->
  <div class="content-area">
    <div class="data-sections">
      <!-- Left section - Summary -->
      <div class="left-section">
        <mat-card class="summary-card">
          <mat-card-header>
            <mat-card-title class="card-title">Resumen de la distribución PGN Inversión</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <!-- Single column items -->
            <div class="summary-item">
              <div class="summary-title">Vigencia</div>
              <div class="summary-value">{{selectedVigencia?.vigencia}}</div>
            </div>
            
            <div class="summary-item">
              <div class="summary-title">Período</div>
              <div class="summary-value">{{selectedPeriodo?.label}}</div>
            </div>

            <!-- Two column items -->
            <div class="summary-item two-column">
              <div class="summary-title">Total Presupuesto PGN - Inversión</div>
              <div class="summary-values">
                <div class="summary-value">{{formatCurrency(resumenData.totalPresupuesto)}}</div>
                <div class="summary-percentage">{{resumenData.totalPorcentaje}}%</div>
              </div>
            </div>

            <div class="summary-item two-column">
              <div class="summary-title">Regionalizado</div>
              <div class="summary-values">
                <div class="summary-value">{{formatCurrency(resumenData.regionalizado)}}</div>
                <div class="summary-percentage">{{resumenData.regionalizadoPorcentaje}}%</div>
              </div>
            </div>

            <div class="summary-item two-column">
              <div class="summary-title">Nacional</div>
              <div class="summary-values">
                <div class="summary-value">{{formatCurrency(resumenData.nacional)}}</div>
                <div class="summary-percentage">{{resumenData.nacionalPorcentaje}}%</div>
              </div>
            </div>

            <div class="summary-item two-column">
              <div class="summary-title">Por Regionalizar</div>
              <div class="summary-values">
                <div class="summary-value">{{formatCurrency(resumenData.porRegionalizar)}}</div>
                <div class="summary-percentage">{{resumenData.porRegionalizarPorcentaje}}%</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Right section - Table -->
      <div class="right-section">
        <mat-card class="table-card">
          <mat-card-header>
            <mat-card-title class="card-title">Distribución por Departamento</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p-table [value]="departamentosData" [scrollable]="true" scrollHeight="615px">
              <ng-template pTemplate="header">
                <tr>
                  <th>Departamento</th>
                  <th class="text-right">{{selectedVigencia?.vigencia}}</th>
                  <th class="text-right">Per Capita</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-dept>
                <tr>
                  <td>{{dept.departamento}}</td>
                  <td class="text-right">{{formatCurrency(dept.vigencia)}}</td>
                  <td class="text-right">{{formatPercentage(dept.perCapita)}}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="footer">
                <tr class="total-row">
                  <td><strong>Total General</strong></td>
                  <td class="text-right"><strong>{{formatCurrency(getTotalVigencia())}}</strong></td>
                  <td class="text-right"><strong>{{formatPercentage(getAveragePerCapita())}}</strong></td>
                </tr>
              </ng-template>
            </p-table>
            
            <div class="export-section">
              <button pButton type="button" icon="pi pi-file-excel" label="Exportar Excel" 
                class="p-button-primary" (click)="exportToExcel()">
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>

</div>
